
// Menu movements to select news channel.
var movement = [[641, 1378, 260], [943, 1381, 260], [981, 1382, 260], [1834, 1382, 261], [5846, 1376, 262], [5899, 1345, 262], [5954, 1300, 254], [6010, 1248, 245], [6065, 1218, 240], [6120, 1204, 235], [6175, 1197, 231], [6230, 1190, 228], [6285, 1180, 225], [6341, 1170, 222], [6397, 1153, 218], [6452, 1143, 217], [6508, 1133, 214], [6562, 1121, 211], [6611, 1105, 209], [6662, 1085, 205], [6714, 1058, 200], [6765, 1040, 196], [6815, 1025, 192], [6866, 1013, 189], [6917, 1004, 187], [6970, 993, 184], [7022, 982, 182], [7074, 974, 180], [7129, 965, 178], [7184, 953, 175], [7756, 858, 160], [7848, 859, 160], [7901, 860, 160], [8068, 859, 160], [8120, 855, 160], [8174, 852, 160], [8226, 850, 160], [8279, 845, 160], [8330, 838, 160], [8383, 823, 160], [8436, 807, 160], [8486, 791, 160], [8540, 777, 160], [8595, 758, 160], [8649, 747, 160], [8702, 733, 160], [8757, 705, 160], [8812, 691, 160], [9143, 687, 157], [9198, 630, 147], [9253, 587, 141], [9310, 545, 141], [9364, 513, 141], [9418, 500, 141], [9472, 490, 141], [9526, 481, 141], [9578, 468, 141], [9633, 446, 142], [9687, 417, 148], [9738, 378, 154], [9791, 348, 159], [9845, 339, 159], [9899, 330, 163], [9952, 319, 173], [10008, 308, 194], [10062, 297, 219], [10114, 288, 255], [10167, 282, 289], [10222, 277, 315], [10278, 273, 330], [10331, 270, 346], [10388, 266, 362], [10442, 263, 375], [10496, 258, 391], [10551, 255, 400], [10607, 254, 412], [10663, 254, 422], [10720, 253, 427], [10821, 253, 431], [10878, 252, 437], [10935, 251, 440], [10990, 251, 441], [11086, 251, 444], [11144, 252, 452], [11200, 253, 459], [11257, 255, 461], [11314, 259, 463], [11370, 267, 464], [11428, 281, 468], [11485, 303, 470], [11541, 350, 478], [11600, 405, 487], [11655, 421, 489], [11713, 424, 489], [11769, 431, 491], [11824, 446, 492], [11881, 457, 492], [11936, 466, 492], [11992, 478, 492], [12049, 498, 494], [12105, 525, 495], [12161, 546, 496], [12218, 592, 496], [12276, 669, 496], [12332, 703, 490], [12388, 701, 490], [12446, 689, 490], [12500, 628, 498], [12558, 507, 503], [12614, 445, 498], [12671, 436, 494], [12854, 434, 494], [12910, 429, 494], [12968, 420, 493], [13025, 412, 490], [13082, 402, 484], [13140, 394, 479], [13197, 385, 476], [13254, 366, 469], [13312, 330, 451], [13368, 289, 408], [13427, 248, 345], [13483, 236, 327], [13538, 234, 312], [13596, 230, 299], [13652, 224, 264], [13707, 222, 227], [13766, 224, 204], [13823, 226, 182], [13878, 226, 167], [13936, 226, 160], [13992, 227, 155], [14048, 231, 148], [14105, 239, 141], [14160, 244, 137], [14347, 247, 133], [14405, 251, 128], [14461, 257, 125], [14520, 270, 123], [14576, 289, 122], [14633, 308, 134], [14691, 319, 150], [14748, 307, 166], [14806, 278, 145], [14865, 276, 119], [14921, 405, 115], [14978, 456, 142], [15035, 462, 158], [15094, 475, 167], [15149, 501, 177], [15205, 529, 197], [15261, 533, 210], [15317, 534, 228], [15375, 534, 245], [15432, 534, 259], [15488, 541, 284], [15543, 554, 305], [15599, 577, 323], [15656, 581, 324]];	
var selectnews = createMenuPlayerEffect(movement, 'channels2.png');
var movement2 = [[23, 614, 656], [1647, 610, 654], [1706, 607, 652], [1764, 605, 650], [1821, 602, 645], [1879, 601, 640], [1937, 601, 638], [1994, 600, 637], [2051, 598, 634], [2107, 595, 629], [2165, 592, 624], [2221, 587, 616], [2278, 582, 609], [2334, 579, 602], [2390, 577, 597], [2447, 575, 593], [2504, 573, 589], [2560, 572, 585], [2619, 571, 582], [2675, 569, 578], [2731, 569, 577], [2789, 567, 574], [2845, 564, 567], [2901, 560, 562], [2957, 557, 554], [3014, 552, 544], [3073, 549, 535], [3129, 547, 525], [3187, 542, 510], [3247, 538, 497], [3303, 535, 480], [3362, 530, 466], [3420, 521, 445], [3481, 518, 439], [3539, 517, 435], [3597, 514, 430], [3656, 508, 417], [3713, 502, 401], [3772, 492, 387], [3832, 483, 382], [3888, 476, 381], [4081, 477, 381], [4139, 475, 378], [4199, 473, 372], [4255, 468, 363], [4313, 462, 355], [4371, 458, 349], [4429, 454, 342], [4488, 450, 334], [4545, 446, 321], [4602, 441, 305], [4662, 434, 287], [4719, 430, 277], [4777, 424, 266], [4833, 418, 259], [4890, 414, 251], [4950, 410, 246], [5007, 406, 243], [5068, 402, 239], [5128, 401, 238], [5185, 396, 233], [5243, 391, 226], [5302, 388, 222], [5362, 380, 212], [5420, 374, 206], [5481, 363, 198], [5540, 357, 193], [5597, 348, 186], [5658, 339, 178], [5715, 331, 172], [5775, 323, 166], [5833, 313, 159], [5891, 302, 153], [5950, 289, 148], [6009, 281, 143], [6068, 275, 140], [6126, 271, 138], [6187, 263, 135], [6247, 255, 133], [6306, 250, 131], [6365, 243, 130], [6423, 238, 128], [6484, 232, 127], [6541, 227, 126], [6597, 222, 126], [6658, 217, 126], [6715, 213, 126], [6771, 212, 126], [6956, 209, 126], [7015, 208, 126], [10546, 207, 126], [10604, 182, 145]];
var selectwefat = createMenuPlayerEffect(movement2, 'channels2.png');
var movement3 = [[4, 182, 17], [190, 184, 15], [248, 186, 15], [304, 187, 16], [555, 187, 15], [610, 188, 17], [665, 188, 23], [910, 195, 23], [2343, 334, 66], [2401, 355, 63], [2458, 362, 62], [2514, 366, 62], [2573, 374, 71], [2629, 377, 80], [2732, 381, 80], [2789, 394, 81], [2846, 405, 81], [2904, 416, 81], [2962, 432, 81], [3018, 441, 81], [3075, 451, 83], [3131, 466, 84], [3188, 476, 86], [3246, 480, 87], [3303, 476, 86], [3360, 474, 85], [3542, 480, 86], [3599, 484, 85], [3657, 513, 82], [3713, 541, 82], [3770, 559, 82], [3829, 575, 82], [3885, 589, 82], [3942, 597, 82], [4000, 600, 81], [4057, 602, 80], [4117, 610, 80], [4174, 620, 77], [4231, 629, 75], [4291, 634, 74], [4348, 639, 71], [4408, 646, 68], [4466, 656, 66], [4522, 671, 62], [4580, 700, 58], [4637, 721, 58], [4695, 725, 55], [4753, 718, 53], [5019, 721, 55], [5075, 722, 55], [5130, 733, 56], [5184, 752, 56], [5242, 764, 53], [5299, 776, 52], [5356, 791, 51], [5412, 802, 51], [5469, 815, 51], [5523, 827, 51], [5578, 836, 51], [5632, 843, 51], [5687, 861, 52], [5744, 883, 55], [5801, 900, 61], [5859, 916, 63], [5916, 934, 64], [5971, 942, 64], [6028, 964, 72], [6086, 997, 83], [6142, 998, 83], [6367, 998, 85], [6426, 1002, 85], [6482, 1017, 87], [6539, 1052, 93], [6598, 1073, 92], [6657, 1078, 92], [6716, 1081, 95], [6776, 1081, 102], [6833, 1081, 114], [6890, 1079, 130], [6950, 1071, 145], [7009, 1064, 157], [7066, 1059, 166], [7124, 1052, 178], [7181, 1042, 191], [7239, 1034, 200], [7298, 1027, 208], [7357, 1022, 212], [7415, 1018, 215], [7474, 1013, 218], [7535, 1001, 227], [7593, 997, 228], [7865, 995, 231], [7923, 994, 232], [10629, 993, 232], [10684, 1106, 232], [10744, 1269, 242], [10803, 1428, 276], [12379, 1438, 494], [12435, 1239, 574], [12494, 996, 674], [12553, 850, 721]];
var selecteating = createMenuPlayerEffect(movement3, 'wiifatmenu.png', true);
var movement4 = [[93, 1383, 62], [312, 1382, 62], [365, 1379, 62], [463, 1381, 62], [519, 1382, 62], [575, 1379, 62], [758, 1377, 62], [814, 1378, 63], [872, 1385, 64], [927, 1381, 64], [984, 1380, 64], [1087, 1381, 64], [1143, 1377, 64], [1202, 1368, 64], [1258, 1369, 64], [1748, 1370, 64], [1808, 1371, 64], [2134, 1369, 64], [2192, 1359, 61], [2249, 1356, 60], [2306, 1355, 59], [2363, 1349, 56], [2421, 1339, 53], [2479, 1316, 48], [2536, 1299, 44], [2592, 1287, 39], [2649, 1275, 34], [2707, 1261, 31], [2763, 1241, 28], [2820, 1226, 28], [2876, 1208, 28], [2932, 1181, 28], [2990, 1145, 28], [3047, 1132, 28], [3146, 1131, 28], [3203, 1102, 32], [3261, 1047, 32], [3317, 1000, 32], [3376, 934, 33], [3432, 872, 43], [3491, 814, 52], [3550, 799, 70], [3609, 874, 83], [3667, 948, 90], [3725, 954, 91], [3781, 953, 90], [3884, 953, 88], [3943, 953, 85], [4000, 950, 84], [4057, 912, 79], [4116, 862, 79], [4174, 814, 86], [4232, 792, 89], [4291, 791, 94], [4347, 815, 91], [4574, 816, 88], [4632, 805, 77], [4689, 723, 64], [4746, 623, 60], [4805, 584, 60], [4863, 583, 60], [5008, 584, 60], [5065, 634, 57], [5125, 681, 52], [5183, 701, 48], [5239, 701, 47], [5297, 724, 44], [5356, 764, 44], [5413, 799, 44], [5472, 820, 44], [5531, 830, 39], [5761, 831, 39], [5818, 858, 51], [5875, 896, 64], [5932, 930, 69], [5992, 940, 70], [6052, 962, 79], [6110, 984, 88], [6171, 994, 97], [6228, 1001, 106], [6286, 1002, 106], [6346, 1007, 107], [6402, 1010, 109], [6463, 1011, 113], [6517, 1011, 114], [6575, 1011, 115], [6634, 1014, 118], [6694, 1017, 123], [6756, 1023, 126], [6817, 1029, 131], [6877, 1036, 136], [6937, 1041, 141], [6997, 1045, 148], [7056, 1048, 152], [7111, 1051, 158], [7174, 1053, 165], [7232, 1056, 170], [7291, 1062, 179], [7351, 1069, 188], [7410, 1072, 196], [7470, 1076, 208], [7530, 1078, 219], [7591, 1078, 228], [7651, 1078, 237], [7710, 1075, 252], [7772, 1071, 263], [7834, 1067, 273], [7891, 1063, 283], [7953, 1060, 286], [8012, 1057, 291], [8072, 1054, 295], [8133, 1050, 301], [8192, 1047, 305], [8254, 1043, 311], [8312, 1039, 315], [8374, 1035, 319], [8432, 1031, 323], [8495, 1024, 332], [8556, 1016, 339], [8614, 1011, 345], [8677, 1006, 351], [8736, 1002, 354], [8796, 998, 358], [8858, 995, 363], [8918, 994, 364], [8976, 992, 371], [9037, 992, 373]];
var selectlens = createMenuPlayerEffect(movement4, 'wiifatmenu.png', true);
var movement5 = [[18, 1216, 120], [225, 1222, 120], [281, 1221, 120], [379, 1220, 120], [524, 1222, 118], [580, 1222, 117], [636, 1223, 120], [694, 1222, 121], [751, 1219, 116], [810, 1218, 108], [866, 1219, 107], [923, 1220, 107], [982, 1220, 110], [1038, 1219, 111], [1097, 1216, 110], [1153, 1213, 108], [1297, 1211, 107], [1357, 1201, 101], [1416, 1189, 97], [1474, 1171, 92], [1532, 1143, 87], [1589, 1120, 82], [1648, 1104, 81], [1704, 1099, 81], [1764, 1095, 81], [1821, 1089, 81], [1879, 1082, 81], [1939, 1076, 81], [1996, 1068, 81], [2054, 1058, 81], [2112, 1046, 81], [2170, 1039, 81], [2229, 1034, 81], [2287, 1029, 81], [2344, 1023, 81], [2402, 1019, 81], [2459, 1015, 81], [2517, 1009, 81], [2572, 1003, 81], [2628, 1000, 81], [3077, 998, 83], [3384, 997, 88], [3443, 997, 96], [3500, 997, 104], [3558, 998, 123], [3615, 1006, 149], [3672, 1021, 175], [3730, 1044, 200], [3788, 1067, 223], [3845, 1098, 247], [3902, 1113, 263], [3958, 1136, 294], [4016, 1157, 321], [4073, 1172, 348], [4129, 1178, 363], [4187, 1181, 376], [4245, 1181, 386], [4302, 1181, 396], [4361, 1181, 403], [4419, 1181, 410], [4479, 1181, 413], [4535, 1179, 417], [4591, 1177, 422], [4651, 1175, 425], [4709, 1173, 429], [4768, 1171, 430], [4826, 1169, 432], [4884, 1166, 433], [4943, 1163, 436], [5001, 1159, 439], [5060, 1154, 442], [5117, 1144, 448], [5175, 1137, 454], [5235, 1130, 456], [5292, 1120, 460], [5352, 1110, 464], [5409, 1099, 468], [5468, 1089, 472], [5527, 1076, 477], [5585, 1053, 487], [5646, 1010, 505], [5705, 975, 527], [5763, 952, 544], [5823, 944, 549], [5880, 942, 550], [13395, 942, 549], [13449, 1061, 544], [13503, 1183, 542], [13558, 1265, 549], [13613, 1314, 569], [13670, 1350, 587], [13725, 1385, 593], [13781, 1414, 590], [13837, 1439, 588], [13894, 1456, 585], [14959, 1372, 707]];
var selectcrash = createMenuPlayerEffect(movement5, 'wiifatmenu.png', true);

// The demo consists of several effects that each get rendered in succession, starting at
// time t (milliseconds) and lasting until the next effect. The demo ends when a null effect
// is encountered.
var effects = [
	{'t' : 0, 'effect' : null, 'name' : 'guessing when music might have started... :('},
	{'t' : 1, 'effect' : selectnews, 'name' : 'select news'},
	{'t' : 17000, 'effect' : news, 'name' : 'news'},
	{'t' : 46000, 'effect' : selectwefat, 'name' : 'select we fat'},
	{'t' : 55000, 'effect' : bodytest, 'name' : 'body test'},
	{'t' : 84000, 'effect' : selecteating, 'name' : 'select eating'}, 
	{'t' : 94500, 'effect' : placebacon, 'name' : 'place bacon'},
	{'t' : 100000, 'effect' : eatbacon, 'name' : 'eating bacon'},
	{'t' : 120000, 'effect' : selectlens, 'name' : 'select lens'}, 
	{'t' : 132000, 'effect' : lens, 'name' : 'lens'},
	{'t' : 147000, 'effect' : selectcrash, 'name' : 'select crash'}, 
	{'t' : 153000, 'effect' : guru, 'name' : 'crash'}, 
	{'t' : 300000, 'effect' : null, 'name' : 'the end'}
];
/*var effects = [
	{'t' : 0, 'effect' :selecteating, 'name' : 'place bacon'}
];*/

var delay = 3000;
for (var i=0; i<effects.length; i++) {
	if (effects[i].t > 0) effects[i].t += delay;
}

var mouseX = -1;
var mouseY = -1;
var ctx = null; // graphics context
var frame = 0;
var width = -1;
var height = -1;

var lastTime = null;
var framesDone = 0;
function frameComplete() {
	framesDone++;
	var d = new Date();
	var now = d.getTime();
	if (lastTime === null) {
		lastTime = now;
		return;
	}
	if (now - lastTime > 1000) {
		e('fps').innerHTML = framesDone + ' frames / second';
		framesDone = 0;
		lastTime = now;
	}
}
		
function fill(color) {
	ctx.fillStyle = color;
	ctx.fillRect(0, 0, width, height);
}

var demoStartTime = null;
var t;
function timing() {
	var d = new Date();
	var now = d.getTime();
	if (demoStartTime === null) demoStartTime = now;	
	t = now - demoStartTime;

	var currentEffect, nextEffect;
	for (var i=0; i<effects.length; i++) {
		if (t >= effects[i].t) {
			currentEffect = effects[i];
			nextEffect = effects[i+1];
		}
	}
	var info = "Current effect: "+currentEffect.name;
	if (nextEffect) info += "<br/>Next effect: "+nextEffect.name;
	
	e('elapsed').innerHTML = t + ' ms passed<br/><span style="font-size:70%">' + info + "</span>";
	return currentEffect;
}

function refresh() {
	var currentEffect = timing();
	if (currentEffect.effect !== null) {
		currentEffect.effect.render(ctx, width, height, t-currentEffect.t);
	}
	
	frame++;
	frameComplete();	
	setTimeout(refresh, 20); // leave some time for user interaction between frames (hmm maybe 10ms is longish)
}

function startLoading(src) {
	var texture = new Image();
	texture.loaded = false;
	texture.onload = function() {
		texture.loaded = true;			
	}
	texture.src = src;
	return texture;
}


function init() {
	canvasDivId = 'canvas';
	width = e(canvasDivId).width;
	height = e(canvasDivId).height;
	ctx = e(canvasDivId).getContext('2d');
	
	e(canvasDivId).onmousemove = function(e) {
		mouseX = e.pageX;
		mouseY = e.pageY;
	};
	
/*'nanoface.png'*//*'nanoface.png'*//* 'http://upload.wikimedia.org/wikipedia/commons/e/e6/Muybridge_horse_gallop_animated.gif'*/
	
	for (var i=0; i<effects.length; i++) {
		if (effects[i].effect !== null) {
			effects[i].effect.init(ctx);
		}
	}
	
	refresh();
}
	
